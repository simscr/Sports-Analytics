---
title: "MLB Data"
author: "CS"
date: "9/15/2021"
output: html_document
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  warning = FALSE,
  message = FALSE,
  echo = FALSE,
  fig.retina = 3,
  fig.path = here::here("exports", "MLB", "Plots", "/")
)
pacman::p_load(pacman, tidyverse, janitor, here, rio, job, skimr)
theme_set(theme_bw(base_size = 15))
```

```{r mlb-data, include = F}
p_load(Lahman, pitchRx, retrosheet, openWAR, baseballr)

#browseURL("https://tht.fangraphs.com/author/billpetti/")

#browseURL("https://billpetti.github.io/baseballr/")

betts_id <- playerid_lookup("Betts") %>%
  filter(first_name == "Mookie") %>%
  select(mlbam_id, first_name, last_name)

oneill_id <- playerid_lookup("Neill") %>% 
  filter(first_name == "Tyler") %>% 
  select(mlbam_id, first_name, last_name)

goldy_id <- playerid_lookup("Goldsch") %>% 
  filter(first_name == "Paul") %>% 
  select(mlbam_id, first_name, last_name)

hit_sum <- function(df){
  df  %>% 
  filter(!is.na({{events}})) %>% 
  group_by({{game_date}}) %>% 
  mutate(hits = sum({{events}} %in% c("single", "double", "triple", "home_run")),
         pa = sum(!is.na({{events}} == T)),
         ab = pa - sum({{events}} %in% c("hit_by_pitch", "sac_fly", "walk")),
         game_avg = hits/ab, 3) %>% 
  ungroup() %>% 
  mutate(avg = round(cummean(game_avg), 3))
  arrange({{game_date}})
}
```

## Tyler O'Neill

```{r, include = F}
oneill_2021 <- scrape_statcast_savant(start_date = "2021-03-31", end_date = Sys.Date()-1,
                                      playerid = oneill_id[1, 1], player_type = "batter")

skim(oneill_2021)
```

```{r}
oneill_2021 %>% 
  group_by(game_date) %>% 
  select(launch_speed) %>% 
  summarize_all(mean, na.rm = T) %>% 
  ggplot(aes(game_date, launch_speed)) + 
  geom_point() + 
  geom_smooth(method = "lm", se = F)
```

```{r}
sum_oneill <- oneill_2021 %>% 
  filter(!is.na(events)) %>% 
  group_by(game_date) %>% 
  mutate(hits = sum(events %in% c("single", "double", "triple", "home_run")),
         pa = sum(!is.na(events == T)),
         ab = pa - sum(events %in% c("hit_by_pitch", "sac_fly", "walk")),
         game_avg = round(hits/ab, 3)) %>% 
  ungroup() %>% 
  mutate(avg = cummean(game_avg))
  arrange(game_date)
  
sum_oneill2 <- hit_sum(oneill_2021)
```

```{r}
sum_oneill %>% 
  ggplot(aes(game_date, avg)) + 
  geom_point() + 
  geom_smooth(method = "lm", se = F) +
  lims(y = c(.200, .400))
```

# Paul Goldschmidt

```{r}

```

